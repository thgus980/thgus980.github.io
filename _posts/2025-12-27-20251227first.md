---
layout: single
title:  "[2025-12-27] 20251227 개발일지"
categories: devlog
toc: true
---

## 챗봇 아키텍처

### AWS 서버리스와 ChromaDB
- ChromaDB의 서버리스 문제점: 로컬 파일 시스템에 데이터를 저장. App Runner의 경우 컨테이너 재시작 시 데이터 손실 -> 서버가 재시작되거나 스케일링 될 때, 내부에 저장된 파일이 전부 초기화(삭제)
    - 로컬 PC: ChromaDB를 쓰면 로컬 폴더에 chroma.sqlite3 같은 파일이 생기고, 껐다 켜도 데이터가 남아 있음
    - 서버리스: 컨테이너가 꺼지는 순간 내부에 생성된 DB 파일도 함께 사라짐. 다음 날 출근해서 접속해보면 챗봇이 아무것도 기억 못 하는 상황
- 추천 해결 방법? ChromaDB를 클라우드 벡터DB(Pinecone, Qdrant Cloud OpenSearch Serverless 등)로 교체/ S3를 영구 저장소로 사용/ EFS를 영구 저장소로 사용
- 꼼수? 읽기 전용 방식으로 배포하기 -> 데이터를 이미지에 포함해서 배포하기 (ChromaDB는 서버리스에서 파일이 날아가는 문제가 있으니, 로컬에서 미리 DB를 생성해서 Docker 이미지 안에 넣고 배포)
- 사내 규정 문서가 매일 바뀌는 게 아니라면, Docker 이미지를 만들 때 DB 데이터도 같이 구워서 올리는 방법 사용
    1. 로컬에서 DB 생성
    2. 이미지에 포함: Dockerfile을 작성할 때, 생성된 Chroma 폴더를 컨테이너 내부로 복사
    3. 배포: 이 상태로 AWS App Runner에 올리면, 서버가 켜질 때 이미 완성된 DB를 가지고 시작하므로 검색이 잘 됨. (단, 서버에서 문서를 추가 업로드해도 재시작하면 사라짐)
- ChromaDB 사용 시 임베디드 모드 방식이라면(로컬 폴더에 저장) 별도 서버 불필요 -> 하지만 파일 저장소가 필요하기 때문에 서버리스에서 문제가 발생하는 것
- 하지만 위의 꼼수 방법도 문서 개수가 10-20개정도로 적어야 추천. 이미지 크기가 급증하여 배포 및 빌드 시간 증가함
