---
layout: single
title:  "[2026-02-15] 20260215 개발일지"
categories: devlog
toc: true
---

## RPA 고도화 방안: 중앙 집중식 '로그 분석 및 DB화'

### 1. 로그 테이블 설계 예시
- ```SQL
  -- RPA 통합 로그 테이블 생성
  CREATE TABLE rpa_execution_logs (
      log_id SERIAL PRIMARY KEY,
      bot_name VARCHAR(50) NOT NULL,          -- 어떤 봇인가? (예: HR_Batch_Bot)
      task_name VARCHAR(100) NOT NULL,         -- 구체적인 작업명
      status VARCHAR(20) NOT NULL,            -- SUCCESS, FAILED, RUNNING
      message TEXT,                           -- 요약 메시지
      error_details TEXT,                     -- 에러 발생 시 StackTrace 저장
      start_time TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
      end_time TIMESTAMP WITH TIME ZONE,
      duration_sec INTEGER,                   -- 소요 시간(초)
      processed_count INTEGER DEFAULT 0       -- 처리한 데이터 건수 (실적 산정용)
  );
  
  -- 인덱스 추가 (봇 이름과 상태로 빠른 검색 가능하게)
  CREATE INDEX idx_bot_status ON rpa_execution_logs (bot_name, status);
  ```

### 2. 공통 로그 모듈 만들기: Python의 ppsycopg2 라이브러리 활용
- ```python
  import psycopg2
  from datetime import datetime
  
  class RPALogger:
      def __init__(self):
          # DB 연결 정보 (보안을 위해 환경 변수나 Secret Manager 사용 권장)
          self.conn_params = {
              "host": "your-db-host",
              "database": "rpa_db",
              "user": "sohyun_admin",
              "password": "yourpassword",
              "port": 5432
          }
  
      def start_log(self, bot_name, task_name):
          """작업 시작 시 로그 생성하고 log_id 반환"""
          query = """
              INSERT INTO rpa_execution_logs (bot_name, task_name, status)
              VALUES (%s, %s, 'RUNNING') RETURNING log_id;
          """
          conn = psycopg2.connect(**self.conn_params)
          cur = conn.cursor()
          cur.execute(query, (bot_name, task_name))
          log_id = cur.fetchone()[0]
          conn.commit()
          cur.close()
          conn.close()
          return log_id
  
      def end_log(self, log_id, status, message="", error_details="", processed_count=0):
          """작업 종료 시 로그 업데이트"""
          query = """
              UPDATE rpa_execution_logs 
              SET status = %s, 
                  message = %s, 
                  error_details = %s, 
                  processed_count = %s,
                  end_time = CURRENT_TIMESTAMP,
                  duration_sec = EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - start_time))
              WHERE log_id = %s;
          """
          conn = psycopg2.connect(**self.conn_params)
          cur = conn.cursor()
          cur.execute(query, (status, message, error_details, processed_count, log_id))
          conn.commit()
          cur.close()
          conn.close()
  
  # 사용 예시
  # logger = RPALogger()
  # current_id = logger.start_log("Invoice_Bot", "Daily_Extraction")
  # ... 작업 수행 ...
  # logger.end_log(current_id, "SUCCESS", message="100건 처리 완료", processed_count=100)
  ```

### 3. RPA 툴에 연동
1. 시작 단계: Python Script 실행 액션을 통해 start_log 함수 호출 → log_id 변수에 저장.
2. 본 작업: 기존 RPA 로직 수행.
3. Try-Catch문 활용:
  - Success 시: end_log 호출 (status='SUCCESS').
  - Error 시: Catch문에서 end_log 호출 (status='FAILED', error_details=Exception메시지).

### 4. 응용 예시 (이번 달 봇별 총 절감 시간 계산)
- ```SQL
  -- 이번 달 봇별 총 절감 시간 계산 (1건당 평균 5분 소요된다고 가정)
  SELECT 
      bot_name,
      SUM(processed_count) as total_count,
      ROUND(SUM(processed_count) * 5.0 / 60, 1) as saved_hours,
      ROUND(AVG(duration_sec), 0) as avg_runtime_sec
  FROM rpa_execution_logs
  WHERE status = 'SUCCESS' 
    AND start_time >= DATE_TRUNC('month', CURRENT_DATE)
  GROUP BY bot_name;
  ```
- Grafana나 Streamlit 같은 대시보드 도구와 연결하면, 실시간으로 시각화 가능
