---
layout: single
title:  "[2025-08-24] 20250824 개발일지"
categories: devlog
toc: true
---

## 강좌명: 자바와 스프링 부트로 생애 최초 서버 만들기, 누구나 쉽게 개발부터 배포까지! [서버 개발 올인원 패키지]

### Github Repository
https://github.com/thgus980/library-app

### 1. 기존 코드를 조금 더 객체 지향적으로 -> 연관관계
- User와 UserLoanHistory 객체가 직접 연결될 수 있도록 (여태까지는 BookService가 중간이 꼈음)
- 사용되는 Annotation? `@ManyToOne`, `@OneToMany`
- 연관관계의 주인? Table을 보았을 때 누가 관계의 주도권을 가지고 있는가 (누가 상대방을 보고 있는가?, UserLoanHistory가 주인!)
- **연관관계의 주인이 아닌 쪽(User)에 mappedBy 옵션을 달아 주어야 한다**
- 연관관계의 주인의 값이 설정되어야만 진정한 데이터가 저장된다

### 2. 연관관계의 주인 효과
1. 상대 테이블을 참조하고 있으면 연관관계의 주인
2. 연관관계의 주인이 아니면 mappedBy를 사용
3. 연관관계의 주인의 setter가 사영되어야만 테이블 연결
```java
@OneToMany(mappedBy = "user", cascade = CascadeType.ALL, orphanRemoval = true) // User 객체와 1:N 관계, 연관관계 주인 설정
// cascade? user가 삭제되면 해당 user와 연결된 정보도 같이 삭제 (User가 삭제될 때 User와 연결된 UserLoanHistory까지 한 번에 사라지게 된다
// orphanRemoval? 객체간의 관계가 끊어진 데이터를 자동으로 제거하는 옵션
private List<UserLoanHistory> userLoanHistories=new ArrayList<>();
```

### 3. 연관관계 관련 내용 정리
1. 상대 테이블을 가리키는 테이블이 연관관계의 주인이다. 연관관계의 주인이 아닌 객체는 mappedBy를 통해 주인에게 매여있음을 표시해 주어야 한다
2. 양쪽 모두 연관관계를 갖고 있을 떄는 양쪽 모두 한 번에 맺어주는 게 좋다
3. cascade 옵션을 활용하면, 저장이나 삭제를 할 때 연관관계에 놓인 테이블까지 함께 저장 또는 삭제가 이루어진다
4. orphanRemoval 옵션을 활용하면, 연관관계가 끊어진 데이터를 자동으로 제거해준다

### 4. 책 대출/반납 기능 리팩토링과 지연 로딩
- 도메인 계층에 비즈니스 로직이 들어가도록 (최대한 도메인들끼리 협력할 수 있게 코드를 리팩토링)
- 영속성 컨텍스트의 4번째 능력: 지연 로딩 -> 꼭 필요한 순간에 데이터를 로딩한다 (지연 로딩을 사용하게 되면, 연결되어 있는 객체를 꼭 필요한 순간에만 가져온다)