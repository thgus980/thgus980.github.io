---
layout: single
title:  "[2025-05-11] 20250511 개발일지"
categories: devlog
toc: true
---

## 도서명: RAG 시스템 구축을 위한 랭체인 실전 가이드

### Github Repository
private repository

### 1. 사용자의 쿼리를 재해석해 검색하는 MultiQueryRetriever
1. RAG는 사용자의 질문과 가장 유사한 청크를 바탕으로 근거 자료를 찾는 것이 핵심
2. 질문 문장이 벡터 DB 내 청크들과 유사하지 않은 경우가 있을 수 있음 -> 사용자 질문을 여러 버전으로 만들어 벡터 DB 내 검색이 원활하게끔 하자
3. 예) 생일 휴가는 며칠인가요? (본 질문) -> 생일과 관련된 복지는 무엇이 있나요?, 기념일 휴가의 종류는 무엇인가요?
4. LLM은 Retriever에 주어진 질문의 의도를 파악하고, 여러 버전의 질문을 생성하여 검색 결과가 더욱 풍부해지도록 촉진

### 2. 문서를 여러 벡터로 재해석하는 MultiVectorRetriever
1. 문서의 벡터를 재가공하여 검색 품질을 향상
2. 상위 청크를 하위 청크로 쪼갠다
3. 사용자의 질문과 유사한 문서를 찾을 때, 하위 청크를 검색하고 이를 기반으로 상위 청크를 호출 -> 벡터 DB를 기반으로 하위 유사 청크를 검색하고, 해당 청크들의 문서 id를 타고 올라가 상위 청크를 반환

### 참고
1. 사용자가 프롬프트에 던진 질문과 유사도가 높은 문서를 추출할 때 chunk 단위(글 덩어리)로 비교하는데, 이때 chunk는 글자 수 기준으로 분할 ( 예. 500자 ), 문맥을 파악해서 문맥이 바뀌는 지점을 기준으로 분할, 토큰 단위로 분할 등 다양하게 지정 가능하다.
2. 랭체인에서 지원하는 RecursiveCharacterTextSplitter(글자 수 분할), SemanticChunker(문맥을 파악해 분할), TokenTextSplitter(토큰 단위 분할)을 import 하여 구현 가능하다.
3. ```python
   # 청크 길이 500
   text_splitter=RecursiveCharacterTextSpliter(
     chunk_size=500
   )
   ```
