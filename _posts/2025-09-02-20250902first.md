---
layout: single
title:  "[2025-09-02] 20250902 ê°œë°œì¼ì§€"
categories: devlog
toc: true
---

## ë…¹ìŒíŒŒì¼ ê¸°ë°˜ íšŒì˜ë¡ ì‘ì„±

### 1. GPTë¡œ ë…¹ì·¨ë¡ êµì •í•˜ê¸°
- GPT ì²« í˜¸ì¶œ ì‹œ, í”„ë¡¬í”„íŠ¸ë¥¼ ì¶”ê°€ ì‘ì„±(2ë²ˆ)í•´ì„œ STT ì˜¤ë¥˜ êµì •í•  ìˆ˜ ìˆë„ë¡ í•¨
  ```python
  prompt = f"""
            ë‹¤ìŒì€ {meeting_json['meeting_info']['total_speakers']}ëª…ì´ ì°¸ì„í•œ íšŒì˜ ë‚´ìš©ì…ë‹ˆë‹¤.

            íšŒì˜ ì •ë³´:
            - ì‹œê°„: {meeting_json['meeting_info']['duration_minutes']}ë¶„
            - ë°œì–¸ ìˆ˜: {meeting_json['meeting_info']['total_statements']}ê°œ

            ë°œì–¸ ë‚´ìš©:
            {timeline_text}

            ìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì•„ë˜ì˜ ì¡°ê±´ì„ ê³ ë ¤í•˜ì—¬, ë‹¤ìŒ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì „ë¬¸ì ì¸ íšŒì˜ë¡ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
            1. í•œêµ­ì–´ë¡œ ì „ë¬¸ì ì´ê³  êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
            2. ì£¼ì–´ì§„ ë°œì–¸ ë‚´ìš©ì€ STTë¡œ ì‘ì„±ëœ ê²°ê³¼ì´ë¯€ë¡œ, ì´ ì¤‘ì— ì˜¤ë¥˜ê°€ ìˆëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ ìˆ˜ì •í•˜ì—¬ íšŒì˜ë¡ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
            3. ì‚¬ì‹¤ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ëª¨ë¥´ëŠ” ë‚´ìš©ì„ ë§ë¶™ì´ì§€ ë§ˆì„¸ìš”.
            4. ë¬¸ì¥ì€ '-ë‹¤'ë¡œ ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹Œ ë‹¨ì–´ë‚˜ '-í–ˆìŒ, -í•¨' ë“±ìœ¼ë¡œ ëª…ì‚¬í˜•ìœ¼ë¡œ ëë‚´ì£¼ì„¸ìš”.

            # {meeting_title}

            ## íšŒì˜ ê°œìš”
            - **ì‘ì„± ì¼ì**: {meeting_json['meeting_info']['date']}
            - **ì°¸ì„ì¸ì›**: {meeting_json['meeting_info']['total_speakers']}ëª…
            - **íšŒì˜ ì‹œê°„**: {meeting_json['meeting_info']['duration_minutes']}ë¶„

            ## ì£¼ìš” ë…¼ì˜ì‚¬í•­
            [í•µì‹¬ ì•ˆê±´ 3-5ê°œ]

            ## í™”ìë³„ ì£¼ìš” ë°œì–¸
            [ê° í™”ìì˜ í•µì‹¬ ë°œì–¸ ìš”ì•½]

            ## ê²°ì •ì‚¬í•­
            [êµ¬ì²´ì ì¸ ê²°ì • ë‚´ìš©]
        """
  ```

### 2. í™”ì ë§¤ì¹­ì´ í•„ìš”í•œ ì´ìœ 
- ë¬¸ì œ ìƒí™©: ì…ë ¥ ë°ì´í„° 2ê°œ
  - Whisper: [ì•ˆë…•í•˜ì„¸ìš”] 2-4ì´ˆ
  - pyannote: [í™”ì1] 1-5ì´ˆ
- ëª©í‘œ: ë‘˜ì„ í•©ì³ì„œ -> í™”ì1ì´ 2-4ì´ˆì— 'ì•ˆë…•í•˜ì„¸ìš”'ë¼ê³  ë§í•¨
  ```python
  def match_transcription_with_speakers(self, transcription, speaker_segments):
  """ì „ì‚¬ ê²°ê³¼ì™€ í™”ì ì •ë³´ ë§¤ì¹­"""
  print("ğŸ”— ì „ì‚¬ ê²°ê³¼ì™€ í™”ì ì •ë³´ ë§¤ì¹­ ì¤‘...")
  
  def find_dominant_speaker(start_time, end_time, speaker_segments):
      overlaps = {}
      for seg in speaker_segments:
          overlap_start = max(start_time, seg['start'])
          overlap_end = min(end_time, seg['end'])
          
          if overlap_start < overlap_end:
              overlap_duration = overlap_end - overlap_start
              speaker = seg['speaker']
              
              if speaker not in overlaps:
                  overlaps[speaker] = 0
              overlaps[speaker] += overlap_duration
      
      if overlaps:
          dominant_speaker = max(overlaps.items(), key=lambda x: x[1])[0]
          return dominant_speaker
      return "Unknown"
  
  matched_segments = []
  speaker_mapping = {}
  
  for segment in transcription.segments:
      start_time = segment.start
      end_time = segment.end
      text = segment.text.strip()
      
      raw_speaker = find_dominant_speaker(start_time, end_time, speaker_segments)
      
      if raw_speaker not in speaker_mapping:
          speaker_index = len(speaker_mapping)
          speaker_mapping[raw_speaker] = f"í™”ì {chr(65 + speaker_index)}"
      
      speaker_name = speaker_mapping[raw_speaker]
      
      matched_segments.append({
          'start': round(start_time, 1),
          'end': round(end_time, 1),
          'duration': round(end_time - start_time, 1),
          'speaker': speaker_name,
          'text': text,
          'confidence': round(getattr(segment, 'avg_logprob', 0), 3)
      })
  
  print(f"âœ… ë§¤ì¹­ ì™„ë£Œ: {len(speaker_mapping)}ëª…ì˜ í™”ìë¡œ ì •ë¦¬")
  return matched_segments
  ```
